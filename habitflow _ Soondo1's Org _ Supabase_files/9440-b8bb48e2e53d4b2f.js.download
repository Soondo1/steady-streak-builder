!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ee538ae7-94a9-4beb-80c6-ab4e483f407a",e._sentryDebugIdIdentifier="sentry-dbid-ee538ae7-94a9-4beb-80c6-ab4e483f407a")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9440],{11375:(e,t,s)=>{s.d(t,{d:()=>c});var r=s(80263),a=s(44893),n=s(79279),l=s(53239),o=s(2);let i=(0,n.F)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),d=(0,n.F)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),c=l.forwardRef((e,t)=>{let{className:s,size:n,...l}=e;return(0,r.jsx)(a.bL,{className:(0,o.cn)(i({size:n}),s),...l,ref:t,children:(0,r.jsx)(a.zi,{className:(0,o.cn)(d({size:n}))})})});c.displayName=a.bL.displayName},49440:(e,t,s)=>{s.d(t,{g:()=>B,w:()=>H});var r=s(80263),a=s(53239),n=s(10738),l=s(16601),o=s(2),i=s(68656),d=s(75809),c=s(29127),x=s(76671),h=s(33656),u=s(796);let m=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,u.D)();return(0,r.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"ServiceRoleIcon","data-sentry-source-file":"Icons.tsx",children:(0,r.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,r.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},p=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,u.D)();return(0,r.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AnonIcon","data-sentry-source-file":"Icons.tsx",children:(0,r.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,r.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},g=e=>{let{isSelected:t=!1}=e,{resolvedTheme:s}=(0,u.D)();return(0,r.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AuthenticatedIcon","data-sentry-source-file":"Icons.tsx",children:(0,r.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,r.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===s?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===s?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,r.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===s?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})};var f=s(64238),y=s(87598);let v=function(e){let{label:t,value:s,isSelected:a,onSelectedChange:n,icon:l}=e;return(0,r.jsxs)("label",{className:(0,o.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",a&&"border-foreground-muted hover:border-foreground-muted bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&n(s)},htmlFor:"role-".concat(s),"data-sentry-component":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationRadio.tsx",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[l&&(0,r.jsx)("div",{children:l}),a&&(0,r.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof a&&(0,r.jsx)(f.A,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===a&&(0,r.jsx)(y.A,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,r.jsx)("input",{id:"role-".concat(s),type:"radio",name:"role",value:s,checked:!!a,onChange:e=>{n(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,r.jsxs)("span",{className:(0,o.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",a&&"text-foreground"),children:[null!=t?t:s," role"]})]})};var j=s(56404),b=s(11352),N=s(65842),w=s(23278),k=s(66452),I=s(73969),R=s(89044),S=s(45969),E=s(98474),A=s(783),C=s(89426),_=s(86137),D=s(89756),L=s(71171),T=s(79193),M=s(11375),z=s(83405),U=s(81370);let P=()=>{var e,t,s,n,d;let[h,u]=(0,a.useState)(""),[m,p]=(0,a.useState)("aal1"),[g,f]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),{id:P}=(0,R.g)(),[O,H]=(0,D.M)(R.rS.USER_IMPERSONATION_SELECTOR_PREVIOUS_SEARCHES(P),[]),[B,K]=(0,a.useState)(!1),$=(0,c.RY)(),J=(0,j.d7)(h,300),{project:V}=(0,S.Om)(),{data:Y,isSuccess:q,isLoading:G,isError:Q,error:X,isFetching:ee,isPreviousData:et}=(0,A.aq)({projectRef:null==V?void 0:V.ref,connectionString:null==V?void 0:V.connectionString,keywords:J.trim().toLocaleLowerCase()},{keepPreviousData:!0}),es=(0,a.useMemo)(()=>{var e;return null!=(e=null==Y?void 0:Y.pages.flatMap(e=>e.result))?e:[]},[null==Y?void 0:Y.pages]),er=(null==(e=$.role)?void 0:e.type)==="postgrest"&&"authenticated"===$.role.role&&"native"===$.role.userType&&$.role.user,ea=(null==(t=$.role)?void 0:t.type)==="postgrest"&&"authenticated"===$.role.role&&"external"===$.role.userType&&$.role.externalAuth,en=function(e){let{data:t}=(0,_.op)({projectRef:e});return(0,a.useMemo)(()=>(function(e){if(e&&e.HOOK_CUSTOM_ACCESS_TOKEN_ENABLED)return(0,C.vw)(e.HOOK_CUSTOM_ACCESS_TOKEN_URI,e.HOOK_CUSTOM_ACCESS_TOKEN_SECRETS)})(t),[t])}(null==V?void 0:V.ref),[el,eo]=(0,a.useState)(!1);async function ei(e){eo(!0),H(t=>[...t.filter(t=>t.id!==e.id),e].slice(-6)),(null==en?void 0:en.type)==="https"&&I.oR.info("Please note that HTTPS custom access token hooks are not yet supported in the dashboard.");try{await $.setRole({type:"postgrest",role:"authenticated",userType:"native",user:e,aal:m},en)}catch(e){I.oR.error("Failed to impersonate user: ".concat(e.message))}eo(!1)}async function ed(){eo(!0);let e={};try{e=y?JSON.parse(y):{}}catch(e){I.oR.error("Invalid JSON in additional claims");return}try{await $.setRole({type:"postgrest",role:"authenticated",userType:"external",externalAuth:{sub:g,additionalClaims:e},aal:m},en)}catch(e){I.oR.error("Failed to impersonate user: ".concat(e.message))}eo(!1)}function ec(){$.setRole(void 0),K(!1)}let ex=er?(0,x.Mn)(er,null!=(d=null!=(n=null!=(s=er.email)?s:er.phone)?n:er.id)?d:"Unknown"):ea?$.role.externalAuth.sub:void 0;return(0,r.jsxs)("div",{className:"flex flex-col gap-1","data-sentry-component":"UserImpersonationSelector","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,r.jsx)("h2",{className:"text-foreground text-sm",children:ex?"Impersonating ".concat(ex):"Impersonate a User"}),(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:er||ea?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),er||ea?(0,r.jsxs)(r.Fragment,{children:[er&&(0,r.jsx)(W,{user:er,onClick:ec,isImpersonating:!0,aal:m,isLoading:el}),ea&&(0,r.jsx)(F,{sub:$.role.externalAuth.sub,onClick:ec,aal:m,isLoading:el})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-2 mt-2 relative",children:[(0,r.jsx)(L.A,{className:"table-editor-search border-none",icon:et&&ee?(0,r.jsx)(b.A,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,r.jsx)(N.A,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search by id, email, phone, or name...",onChange:e=>u(e.target.value),value:h,size:"small",actions:h&&(0,r.jsx)(l.$,{size:"tiny",type:"text",className:"px-1",onClick:()=>u(""),children:(0,r.jsx)(w.A,{size:12,strokeWidth:2})})}),(0,r.jsxs)(T.Nt,{children:[(0,r.jsx)(T.R6,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,r.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,r.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Advanced options"}),(0,r.jsx)(i.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,r.jsxs)(T.Ke,{className:"mt-1 flex flex-col gap-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center gap-x-4 text-sm text-foreground-light",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,r.jsx)("h3",{children:"MFA assurance level"}),(0,r.jsxs)(U.I,{side:"top",className:"flex flex-col gap-1 max-w-96",children:[(0,r.jsxs)("p",{children:["AAL1 verifies users via standard login methods, while AAL2 adds a second authentication factor.",(0,r.jsx)("br",{}),"If you're not using MFA, you can leave this on AAL1."]}),(0,r.jsxs)("a",{href:"/docs/guides/auth/auth-mfa",target:"_blank",rel:"noreferrer",className:"flex items-center gap-x-1 opacity-50 hover:opacity-100 transition",children:["Learn more about MFA ",(0,r.jsx)(k.A,{size:14,strokeWidth:2})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-row items-center gap-x-2 text-xs font-bold",children:[(0,r.jsx)("p",{className:"aal1"===m?void 0:"text-foreground-lighter",children:"AAL1"}),(0,r.jsx)(M.d,{checked:"aal2"===m,onCheckedChange:function(){p(e=>"aal2"===e?"aal1":"aal2")}}),(0,r.jsx)("p",{className:"aal2"===m?void 0:"text-foreground-lighter",children:"AAL2"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,r.jsx)("h3",{className:"text-sm text-foreground-light",children:"External Auth Impersonation"}),(0,r.jsx)(U.I,{side:"top",className:"flex flex-col gap-1 max-w-96",children:(0,r.jsx)("p",{children:"Test RLS policies with external auth providers like Clerk or Auth0 by providing a user ID and optional claims."})})]}),(0,r.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,r.jsx)(M.d,{checked:B,onCheckedChange:K}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Enable external auth impersonation"})]}),B&&(0,r.jsxs)("div",{className:"flex flex-col gap-y-4 mt-2 border rounded-md p-4 bg-surface-100",children:[(0,r.jsx)(L.A,{className:"border-strong",label:"External User ID",descriptionText:"The user ID from your external auth provider",placeholder:"e.g. user_abc123",value:g,onChange:e=>f(e.target.value),size:"small"}),(0,r.jsx)(L.A,{className:"border-strong",label:"Additional Claims (JSON)",descriptionText:"Optional: Add custom claims like org_id or roles",placeholder:'e.g. {"app_metadata": {"org_id": "org_456"}}',value:y,onChange:e=>v(e.target.value),size:"small"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{}),(0,r.jsx)(l.$,{type:"default",disabled:!g,onClick:ed,children:"Impersonate"})]})]})]})]})]}),!B&&(0,r.jsxs)(r.Fragment,{children:[G&&(0,r.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,r.jsx)(b.A,{className:"animate-spin",size:24}),(0,r.jsx)("span",{className:"text-foreground-light",children:"Loading users..."})]}),Q&&(0,r.jsx)(E.A,{error:X,subject:"Failed to retrieve users"}),q&&(es.length>0?(0,r.jsx)("div",{children:(0,r.jsx)("ul",{className:"divide-y max-h-[150px] overflow-y-scroll",role:"list",children:es.map(e=>(0,r.jsx)("li",{role:"listitem",children:(0,r.jsx)(Z,{user:e,onClick:ei,isLoading:el})},e.id))})}):(0,r.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,r.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})})),O.length>0&&(0,r.jsx)("div",{className:"border-t",children:O.length>0?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(T.Nt,{className:"mt-2 relative",children:[(0,r.jsx)(T.R6,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,r.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,r.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Recents"}),(0,r.jsx)(i.A,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,r.jsxs)(T.Ke,{className:"mt-1 flex flex-col gap-y-4",children:[(0,r.jsx)(l.$,{size:"tiny",type:"text",className:"absolute right-0 top-0 py-2 hover:bg-muted flex items-center text",onClick:function(){H([])},children:(0,r.jsx)("span",{className:"flex items-center",children:"Clear"})}),(0,r.jsx)(z.FK,{className:(0,o.cn)(O.length>3?"h-36":"h-auto"),children:(0,r.jsx)("ul",{className:"grid gap-2 ",children:O.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(Z,{user:e,onClick:ei})},e.id))})})]})]})}):(0,r.jsx)("div",{className:"p-4 text-center text-muted-foreground",children:"No recent searches"})})]})]})]})},O=e=>{let{onClick:t,aal:s,displayName:a,avatarUrl:n,isImpersonating:o=!1,isLoading:i=!1}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground","data-sentry-component":"BaseImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-4 pl-0.5 py-0.5 border rounded-full max-w-l",children:[n?(0,r.jsx)("img",{className:"rounded-full w-5 h-5",src:n,alt:a}):(0,r.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)(d.A,{size:12,strokeWidth:2})}),(0,r.jsxs)("span",{className:"text-sm truncate",children:[a," ",(0,r.jsx)("span",{className:"ml-2 text-foreground-lighter text-xs font-light",children:"aal2"===s?"AAL2":"AAL1"})]})]}),(0,r.jsx)(l.$,{type:"default",onClick:t,disabled:i,loading:i,"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:o?"Stop Impersonating":"Impersonate"})]})},W=e=>{var t,s,a;let{user:n,onClick:l,isImpersonating:o=!1,isLoading:i=!1,aal:d}=e,c=(0,x.TW)(n),h=(0,x.Mn)(n,null!=(a=null!=(s=null!=(t=n.email)?t:n.phone)?s:n.id)?a:"Unknown")+(n.is_anonymous?" (anonymous)":"");return(0,r.jsx)(O,{onClick:()=>l(n),aal:d,displayName:h,avatarUrl:c,isImpersonating:o,isLoading:i,"data-sentry-element":"BaseImpersonatingRow","data-sentry-component":"UserImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx"})},F=e=>{let{sub:t,onClick:s,aal:a,isLoading:n=!1}=e;return(0,r.jsx)(O,{onClick:s,aal:a,displayName:t,isImpersonating:!0,isLoading:n,"data-sentry-element":"BaseImpersonatingRow","data-sentry-component":"ExternalAuthImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx"})},Z=e=>{var t;let{user:s,onClick:a,isImpersonating:n=!1,isLoading:o=!1}=e,i=(0,x.TW)(s),c=s.email||s.phone,h=(0,x.Mn)(s,""),u=s.is_anonymous,m=h&&h!==c;return(0,r.jsxs)("div",{className:"flex items-center justify-between py-1 text-foreground","data-sentry-component":"UserRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[i?(0,r.jsx)("img",{className:"rounded-full w-5 h-5",src:i,alt:h||c}):(0,r.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border flex items-center justify-center text-foreground-lighter",children:(0,r.jsx)(d.A,{size:12,strokeWidth:2})}),(0,r.jsxs)("span",{className:"text-sm flex items-center gap-4",children:[c,m&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("span",{className:"text-foreground-lighter",children:[h,u?" (anonymous)":""]})}),(0,r.jsx)("span",{className:"text-foreground-light bg-surface-200 dark:bg-surface-400 rounded-md px-1 py-0.5 font-mono text-xs",children:null==s||null==(t=s.id)?void 0:t.slice(0,8)})]})]}),(0,r.jsx)(l.$,{type:"default",onClick:()=>a(s),disabled:o,loading:o,"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:n?"Stop Impersonating":"Impersonate"})]})},H=e=>{var t;let{serviceRoleLabel:s,padded:n=!0}=e,l=(0,c.RY)(),[i,d]=(0,a.useState)(()=>{var e;return(null==(e=l.role)?void 0:e.type)==="postgrest"&&("anon"===l.role.role||"authenticated"===l.role.role)?l.role.role:"service_role"}),x=!!("authenticated"===i&&(null==(t=l.role)?void 0:t.type)==="postgrest"&&"authenticated"===l.role.role&&("user"in l.role&&l.role.user||"externalAuth"in l.role&&l.role.externalAuth));function u(e){"service_role"===e&&l.setRole(void 0),"anon"===e&&l.setRole({type:"postgrest",role:e}),d(e)}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-3",n?"p-5":"pb-5"),children:[(0,r.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,r.jsxs)("fieldset",{className:"flex gap-3",children:[(0,r.jsx)(v,{value:"service_role",isSelected:"service_role"===i,onSelectedChange:u,label:s,icon:(0,r.jsx)(m,{isSelected:"service_role"===i}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,r.jsx)(v,{value:"anon",isSelected:"anon"===i,onSelectedChange:u,icon:(0,r.jsx)(p,{isSelected:"anon"===i}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,r.jsx)(v,{value:"authenticated",isSelected:"authenticated"===i&&(x||"partially"),onSelectedChange:u,icon:(0,r.jsx)(g,{isSelected:"authenticated"===i}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"})]})}),"service_role"===i&&(0,r.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,r.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===i&&(0,r.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,r.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===i&&(0,r.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,r.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.mB,{}),(0,r.jsx)("div",{className:(0,o.cn)("py-5",n&&"px-5"),children:(0,r.jsx)(P,{})})]})]})},B=e=>{var t,s,d,x;let{portal:h=!0,serviceRoleLabel:u,variant:m="regular",align:p="end"}=e,g=(0,c.RY)(),[f,y]=(0,a.useState)(!1),v=null!=(x=null!=(d=null==(t=g.role)?void 0:t.role)?d:u)?x:"service role";return(0,r.jsxs)(n.AM,{open:f,onOpenChange:y,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"RoleImpersonationPopover","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,r.jsx)(n.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,r.jsx)(l.$,{size:"tiny",type:"default",className:(0,o.cn)("h-[26px] pr-3 gap-0","connected-on-right"===m&&"rounded-r-none border-r-0","connected-on-left"===m&&"rounded-l-none border-l-0","connected-on-both"===m&&"rounded-none border-x-0"),"data-sentry-element":"Button","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-foreground-muted",children:"Role"}),(0,r.jsx)("span",{children:v}),(null==(s=g.role)?void 0:s.type)==="postgrest"&&"authenticated"===g.role.role&&(0,r.jsxs)(r.Fragment,{children:["native"===g.role.userType&&g.role.user?(0,r.jsx)(K,{user:g.role.user}):"external"===g.role.userType&&g.role.externalAuth?(0,r.jsx)($,{sub:g.role.externalAuth.sub}):null,(0,r.jsx)("span",{className:"text-xs text-foreground-lighter font-light",children:"aal2"===g.role.aal?"AAL2":"AAL1"})]}),(0,r.jsx)(i.A,{className:"text-muted",strokeWidth:1,size:12,"data-sentry-element":"ChevronDown","data-sentry-source-file":"RoleImpersonationPopover.tsx"})]})})}),(0,r.jsx)(n.hl,{portal:h,className:"p-0 w-full overflow-hidden",side:"bottom",align:p,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,r.jsx)(H,{serviceRoleLabel:u,"data-sentry-element":"RoleImpersonationSelector","data-sentry-source-file":"RoleImpersonationPopover.tsx"})})]})},K=e=>{var t,s,a;let{user:n}=e,l=(0,x.TW)(n),o=(0,x.Mn)(n,null!=(a=null!=(s=null!=(t=n.email)?t:n.phone)?s:n.id)?a:"Unknown");return(0,r.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"UserRoleButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[l?(0,r.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:l,alt:o}):(0,r.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,r.jsx)(d.A,{size:12,strokeWidth:2})}),(0,r.jsx)("span",{className:"truncate max-w-[84px]",children:o})]})},$=e=>{let{sub:t}=e;return(0,r.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"ExternalAuthButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,r.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,r.jsx)(d.A,{size:12,strokeWidth:2,"data-sentry-element":"IconUser","data-sentry-source-file":"RoleImpersonationPopover.tsx"})}),(0,r.jsx)("span",{className:"truncate max-w-[84px]",children:t})]})}},81370:(e,t,s)=>{s.d(t,{I:()=>o});var r=s(80263),a=s(53239),n=s(3732);let l=(0,a.forwardRef)((e,t)=>(0,r.jsx)("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",...e,children:(0,r.jsx)("path",{d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",fillRule:"evenodd",clipRule:"evenodd"})})),o=(0,a.forwardRef)((e,t)=>{let{...s}=e;return(0,r.jsxs)(n.m_,{children:[(0,r.jsx)(n.k$,{type:"button",role:"button",className:"flex [&_svg]:data-[state=delayed-open]:fill-foreground-lighter [&_svg]:data-[state=instant-open]:fill-foreground-lighter",children:(0,r.jsx)(l,{strokeWidth:2,className:"transition-colors fill-foreground-muted w-4 h-4"})}),(0,r.jsx)(n.ZI,{...s})]})})},89426:(e,t,s)=>{s.d(t,{IT:()=>n,U2:()=>a,vw:()=>r});let r=(e,t)=>{if(e.startsWith("https"))return{type:"https",url:e,secret:t||""};{let[t,s,r,a,n]=(e||"").split("/");return{type:"postgres",schema:a||"",functionName:n||""}}},a=e=>"postgres"===e.method.type&&e.method.schema.length>0&&e.method.functionName.length>0||"https"===e.method.type&&e.method.url.startsWith("https")&&e.method.secret.length>0,n=(e,t)=>["-- Revoke access to function from supabase_auth_admin\nrevoke execute on function ".concat(e,".").concat(t," from supabase_auth_admin;"),"-- Revoke access to schema from supabase_auth_admin\nrevoke usage on schema ".concat(e," from supabase_auth_admin;"),"-- Restore function permissions to authenticated, anon and public\ngrant execute on function ".concat(e,".").concat(t," to authenticated, anon, public;")]}}]);